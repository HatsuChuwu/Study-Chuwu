

* * *

### **文档案例概述：学生课程成绩系统**

#### **问题要求**

文档提到了一个学生课程成绩关系 ，如下：
    R(No, Num, Score, Name, Dept, Dname, Course, Teacher)

* **主键：**
* 属性含义：
  * ：学号
  * ：课程号
  * ：成绩
  * ：姓名
  * ：系部编码
  * ：系部名称
  * ：课程名
  * ：教师

#### **需要分析的内容**

1. 提取实体和它们之间的关系。
2. 绘制函数依赖关系图和E-R图。
3. 建立符合3NF的关系模式。

* * *

### **步骤 1：提取实体与属性**

从问题描述中可以提取以下实体：

1. **学生（Student）**
   * 属性：学号（No，主键）、姓名（Name）、系部编码（Dept）。
2. **系部（Department）**
   * 属性：系部编码（Dept，主键）、系部名称（Dname）。
3. **课程（Course）**
   * 属性：课程号（Num，主键）、课程名称（Course）、教师（Teacher）。
4. **成绩记录（Enrollment）**
   * 属性：学号（No，外键）、课程号（Num，外键）、成绩（Score）。

#### **关系分析：**

1. **学生与成绩记录的关系**：
   * 学生可以选修多门课程（1对多）。
2. **课程与成绩记录的关系**：
   * 每门课程有多名学生选修（1对多）。
3. **学生与系部的关系**：
   * 学生隶属于某个系部（1对1）。

* * *

### **步骤 2：绘制函数依赖关系图**

#### **函数依赖分析：**

1. ：成绩完全依赖于学号和课程号（主键）。
2. ：学生的姓名和系部依赖于学号（部分依赖）。
3. ：系部名称依赖于系部编码（传递依赖）。
4. ：课程名和教师依赖于课程号（部分依赖）。
   
   | **非主属性** | **函数依赖关系**         | **与主键 X(No, Num)** **的函数依赖关系**                                       |
   | -------- | ------------------ | -------------------------------------------------------------------- |
   | Score    | (No, Num)→Score    | **完全函数依赖**：Score 完全由 (No, Num) 决定，单独的 No 或者 Num 不能确定 Score           |
   | Name     | No→Name            | **部分函数依赖**：Name 由 No 决定，所以对主键 (No, Num) 是部分依赖，仅 No 确定就可确定 Name       |
   | Dept     | No→Dept            | **部分函数依赖**：Dept 由 No 决定，对主键 (No, Num) 是部分依赖，仅 No 确定就可确定 Dept         |
   | Dname    | No→Dept，Dept→Dname | **传递函数依赖**：Dname 通过 No 决定 Dept，再由 Dept 决定 Dname，存在间接依赖关系             |
   | Course   | Num→Course         | **部分函数依赖**：Course 由 Num 决定，对主键 (No, Num) 是部分依赖，仅 Num 确定就可确定 Course   |
   | Teacher  | Num→Teacher        | **部分函数依赖**：Teacher 由 Num 确定，对主键 (No, Num) 是部分依赖，仅 Num 确定就可确定 Teacher |

* * *

### **步骤 3：绘制E-R图**

绘制E-R图需明确以下内容：

1. **实体及其属性：**
   * 学生： 为主键。
   * 系部： 为主键。
   * 课程： 为主键。
   * 成绩记录： 为复合主键。
2. **实体之间的关系：**
   * 学生与成绩记录：1对多。
   * 课程与成绩记录：1对多。
   * 学生与系部：1对1。

#### **E-R图结构**

![ad862268-81f5-49f2-85d7-6bf01eba0f3b](file:///D:/%E5%9B%BE%E7%89%87/Typedown/ad862268-81f5-49f2-85d7-6bf01eba0f3b.png)

* * *

### **步骤 4：转换为关系模式**

根据E-R图，将其转化为关系模式：

1. **学生表（Student）：**
      Student(No PK, Name, Dept FK)
* 主键：

* 外键： 关联
  
  2. **系部表（Department）：**
     Department(Dept PK, Dname)

* 主键：
  
  3. **课程表（Course）：**
     Course(Num PK, Course, Teacher)

* 主键：
  
  4. **成绩记录表（Enrollment）：**
     Enrollment(No FK, Num FK, Score, PRIMARY KEY (No, Num))

* 主键：(No,Num)
* 外键：No 关联 Student.No
* 外键：Num 关联 Course.Num

---

### **总结**

通过提取实体和关系，分析函数依赖并设计E-R图，可以清晰地将问题分解成规范化的关系模式：

* 避免冗余数据。
* 确保数据一致性。
* 提高查询效率。

如需进一步详细解读某一部分，欢迎继续讨论！

* * *

**关系模式的规范化：基本概念**
-----------------

**目标：** 消除冗余，避免数据异常（插入、删除、更新异常），提高数据完整性。

1. **1NF（第一范式）**
   
   * **定义：** 每列值必须是**原子值**（不可再分）。
   
   * **检查：** 消除重复组，确保所有字段都只存储单一值。
   
   * **例子：**  
     错误设计（未满足1NF）：
        订单(订单号, 玩具编号, 玩具名称1, 玩具名称2, ...)
     正确设计（满足1NF）：
        订单(订单号, 玩具编号, 玩具名称)

2. **2NF（第二范式）**
   
   * **定义：** 在1NF基础上，消除**部分依赖**（非主属性依赖主键的一部分）。
   
   * **部分依赖：** 如果关系的主键是复合主键，某些非主属性只依赖于主键的一部分，而不是整个主键，就存在部分依赖。
   
   * **检查：**
     
     * 确认主键（单一或复合）。
     * 检查非主属性是否仅依赖主键的一部分。
   
   * **处理方法：** 将存在部分依赖的属性拆分到新的关系中。
   
   * **例子：**  
     错误设计：
        订购(订单号, 玩具编号, 玩具名称, 数量)
     
     * 主键：订单号+玩具编号
     
     * 问题：玩具名称仅依赖“玩具编号”（主键的一部分）。正确设计：
        订单(订单号, 玩具编号, 数量)
        玩具(玩具编号, 玩具名称)

3. **3NF（第三范式）**
   
   * **定义：** 在2NF基础上，消除**传递依赖**（非主属性依赖于另一个非主属性）。
   
   * **传递依赖：** 如果非主属性A依赖于另一个非主属性B，且B依赖于主键，就存在传递依赖。
   
   * **检查：**
     
     * 主键到每个非主属性之间是否有直接依赖。
   
   * **处理方法：** 将传递依赖的属性拆分到新的关系中。
   
   * **例子：**  
     错误设计：
        玩具(玩具编号, 名称, 类别名称, 类别描述)
     
     * 主键：玩具编号
     
     * 问题：类别描述依赖于类别名称，而类别名称依赖主键。正确设计：
        玩具(玩具编号, 名称, 类别编号)
        类别(类别编号, 类别名称, 类别描述)
       
       

* * *

**实例分析：从非规范化到3NF**
------------------

假设有如下关系模式：
    销售记录(客户编号, 客户姓名, 玩具编号, 玩具名称, 玩具类别, 玩具价格, 销售日期, 销售数量)

### **1. 检查是否满足1NF**

分析：

* 任何字段是否有多值属性？
* 这里每个字段都是单一值，已经满足1NF。

* * *

### **2. 检查是否满足2NF**

主键：客户编号+玩具编号+销售日期  
分析：

* **客户姓名**：只依赖于“客户编号”（部分依赖）。
* **玩具名称、玩具类别、玩具价格**：只依赖于“玩具编号”（部分依赖）。

解决：将部分依赖的属性拆分到新表中：

1. 销售记录表：
      销售记录(客户编号, 玩具编号, 销售日期, 销售数量)

2. 客户表：
      客户(客户编号, 客户姓名)

3. 玩具表：
      玩具(玩具编号, 玩具名称, 玩具类别, 玩具价格)
   
   

* * *

### **3. 检查是否满足3NF**

分析：

* **玩具类别**与**玩具价格**是否存在传递依赖？  
  此处没有传递依赖，每个非主属性直接依赖主键。

结论：

* 经过拆分，所有表均达到3NF。

* * *

**总结：部分依赖与传递依赖的核心区分**
---------------------

| **依赖类型** | **定义**                       | **特征**        | **处理方式**      |
| -------- | ---------------------------- | ------------- | ------------- |
| **部分依赖** | 非主属性仅依赖于主键的一部分，而不是整个主键。      | 仅发生在复合主键情况下。  | 将相关属性拆分到新表中。  |
| **传递依赖** | 非主属性依赖于另一个非主属性，而该非主属性又依赖于主键。 | 非主属性间的间接依赖关系。 | 将传递依赖的属性拆分新表。 |
