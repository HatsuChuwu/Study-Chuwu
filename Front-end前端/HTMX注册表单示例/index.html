<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â›„æ³¨å†Œ</title>
    <link rel="stylesheet" href="styles.css">
    <script src="htmx.min.js"></script>
    <style>
        /* æ·»åŠ åŠ¨ç”»ç›¸å…³çš„CSS */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        .shake { animation: shake 0.5s ease-in-out; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .input-error { border-color: #ff4444 !important; }
        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        .error-message.show { display: block; }
    </style>
</head>
<body>
    <img src="images/icon.webp" alt="Logo" class="logo fade-in">

    <div class="register fade-in">
        <h1>æ¬¢è¿æ³¨å†ŒğŸ¥°</h1>
        <h2>æ¯ä¸€å¤©ï¼Œä¹åœ¨å…¶ä¸­</h2>

        <form hx-post="/register" hx-target="this" hx-swap="outerHTML">
            <div class="input-group">
                <input type="text" 
                       id="nickname" 
                       name="nickname"
                       placeholder="è¯·è¾“å…¥æ˜µç§°" 
                       required
                       minlength="2"
                       hx-validate="true"
                       hx-post="/validate/nickname"
                       hx-trigger="keyup changed delay:500ms"
                       hx-target="#nickname-error">
                <div id="nickname-error" class="error-message"></div>
            </div>

            <div class="input-group">
                <input type="password" 
                       id="password" 
                       name="password"
                       placeholder="è¯·è¾“å…¥å¯†ç " 
                       required
                       minlength="8"
                       hx-validate="true"
                       hx-post="/validate/password"
                       hx-trigger="keyup changed delay:500ms"
                       hx-target="#password-error">
                <div id="password-error" class="error-message"></div>
            </div>

            <div class="input-group">
                <label for="phone">æ‰‹æœºå·</label>
                <div class="phone-prefix">
                    <select id="phone-prefix" name="phone_prefix">
                        <option value="+86">+86</option>
                        <option value="+1">+1</option>
                        <option value="+81">+81</option>
                    </select>
                    <input type="tel" 
                           id="phone" 
                           name="phone"
                           placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
                           required
                           pattern="[0-9]{11}"
                           hx-validate="true"
                           hx-post="/validate/phone"
                           hx-trigger="keyup changed delay:500ms"
                           hx-target="#phone-error">
                </div>
                <div id="phone-error" class="error-message"></div>
            </div>

            <div class="agree-terms">
                <label>
                    <input type="checkbox" 
                           name="agree" 
                           required 
                           hx-validate="true"
                           hx-post="/validate/agree"
                           hx-trigger="change"
                           hx-target="#agree-error">
                    æˆ‘å·²é˜…è¯»å¹¶åŒæ„<a href="#" class="terms-link">æœåŠ¡åè®®</a>
                </label>
                <div id="agree-error" class="error-message"></div>
            </div>

            <button class="login-button"
                    type="submit"
                    hx-indicator=".htmx-indicator">
                <span class="htmx-indicator" style="display:none">æ³¨å†Œä¸­...</span>
                <span>ç«‹å³æ³¨å†Œ</span>
            </button>
        </form>
    </div>

    <footer class="fade-in">
        @copyright: 2025Chuwu
    </footer>

    <script>
        // æ·»åŠ è¡¨å•éªŒè¯å’ŒåŠ¨ç”»æ•ˆæœ
        document.body.addEventListener('htmx:validation:validate', function(evt) {
            const input = evt.target;
            const errorDiv = document.querySelector(`#${input.id}-error`);
            
            if (!input.checkValidity()) {
                input.classList.add('input-error');
                input.classList.add('shake');
                if (errorDiv) {
                    errorDiv.textContent = input.validationMessage;
                    errorDiv.classList.add('show');
                }
                setTimeout(() => input.classList.remove('shake'), 500);
            } else {
                input.classList.remove('input-error');
                if (errorDiv) {
                    errorDiv.classList.remove('show');
                }
            }
        });

        // è¡¨å•æäº¤æˆåŠŸåŠ¨ç”»
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            if (evt.detail.successful) {
                evt.target.classList.add('fade-in');
            }
        });

        // é“¾æ¥ç‚¹å‡»åŠ¨ç”»
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                this.classList.add('fade-in');
                setTimeout(() => this.classList.remove('fade-in'), 300);
            });
        });
    </script>
</body>
</html>